# Как работать над проектом

## Окружение

Для удобства работы над проектом используются инструменты из **Node.js** и **npm**. Все необходимые настройки произведены. Убедитесь, что на рабочем компьютере установлен актуальный LTS релиз Node.js**. Актуальная версия **Node.js** указана в файле `package.json` в поле `node`. Затем, в терминале, перейдите в директорию с проектом и _единожды_ запустите команду:

```bash
npm install
```

Команда запустит процесс установки зависимостей проекта из **npm**.

### Сценарии

В `package.json` предопределено несколько сценариев.

#### Скомпилировать проект

```bash
npm run compile
```

Создаст директорию `dist` и скомпилирует проект.

#### Удалить скомпилированный проект

```bash
npm run clean
```

Удаляет директорию `dist`. Используется перед компиляцией.

#### Собрать проект

```bash
npm run build
```

Выполняет сборку проекта: удаляет ранее скомпилированный проект и компилирует заново.

#### Проверить линтером

```bash
npm run lint
```

Запуск проверки проекта статическим анализатором кода **ESLint**.

Линтер проверяет файлы только внутри директории `src`.

**Обратите внимание**, при запуске данной команды, ошибки выводятся в терминал.

#### Запустить ts-модуль без компиляции

```bash
npm run ts -- <Путь к модулю с ts-кодом>
```

Пакет `ts-node` позволяет выполнить TS-код в Node.js без предварительной компиляции. Используется только на этапе разработки.

#### Запустить проект

```bash
npm start
```

В процессе запуска проекта будет выполнен процесс «Сборки проекта» и запуска результирующего кода.

#### Запустить проект в режиме разработки

```bash
npm run start:dev
```

Отличия от обычного режима заключаются в:
- дополнительном запуске автоматического перезапуска nodejs-сервера (средствами nodemon) при изменении любых файлов в в директории src с расширениями .ts / .json
- вывод логов дополнительно обрабатывается пакетом pino-pretty для более читабельного вида

#### Запустить тестовый json-сервер

```bash
npm run json-server
```

В процессе запуска проекта будет создан тесовый json-server, который будет отдавать моковые данные при обращении по адресу http://localhost:3000/api
Офферы: http://localhost:3000/api/offers/
Пользователя: http://localhost:3000/api/users
Данные для сервера находятся в директории `/src/mocks/`, файл `mock-server-data.json`


#### Конфигурация Docker для работы приложения

```bash
docker compose --file ./docker-compose.dev.yml --env-file ./.env --project-name "six-cities" up -d
```

Данная команда сконфигурирует Docker-контейнер для приложения, а также развернет в нем образ mongodb и mongo-express для работы с базой данных.
Конфигурационный файл docker-compose.dev-yml расположен в корне проекта.

#### Переменные окружения

PORT=8000 - Порт, на котором запускается сервер приложения
SERVER_HOST=http://localhost - Хост, на котором запускается сервер
DB_HOST=127.0.0.1 - Хост, на котором развернута база данных
DB_PORT=27017 - Порт, на котором развернута база данных
DB_NAME=six-cities_mongodb - Название БД в MondoDB
DB_NAME_EXPRESS=six-cities_mongo_express - Наименовение UI, используемого для доступа к БД через браузер
DB_USER=admin - Логин пользователя к используемой базе данных (MongoDB)
DB_PASSWORD=test - Пароль пользователя к используемой базе данных (MongoDB)
SALT=[ogj=-2049jt] - Соль, используемая для формирования хэша паролей пользователей
UPLOAD_FILES_DIRECTORY=С:\some\path\six-cities.loc\upload - Директория загрузки пользовательских файлов
JWT_SECRET=ih-034thf0p9it43 - Секрет для формирования JWT-токенов
JWT_SECRET_REFRESH=dpojfg-045j9g0 - Секрет для обновления JWT-токенов
JWT_EXPIRED=2d - Время жизни сформированных токенов
JWT_ALGORITHM=HS256 - Алгоритм, используемый для шифрования JWT-токенов

Примеры переменных окружения также представлены в файле .env.example

## Работа с CLI-приложением

* Список доступных команд:

npm run ts ./src/main.cli.ts -- --help


* Версия приложения:

npm run ts ./src/main.cli.ts -- --version


* Генерация моковых данных (должен быть предварительно-запущен моковый json-сервер):

npm run ts ./src/main.cli.ts — —generate <mocks-count> <tsv-file-path> <json-server-address>

Пример: npm run ts ./src/main.cli.ts — —generate 10 ./src/mocks/mocks-data.tsv http://localhost:3000/api


* Парсинг файла с моковыми данными, сгенерированными командой —generate с дальнейшим занемением их в БД:

npm run ts ./src/main.cli.ts — —import <tsv-file-path> <mongodb-connection-str>

Пример: npm run ts ./src/main.cli.ts — —import ./src/mocks/mocks-data.tsv mongodb://admin:test@127.0.0.1:27017/six-cities_mongodb?authSource=admin

Параметры команд:
<mocks-count> (число) - Количество генерируемых комлектов данных
<tsv-file-path> - Путь к .tsv файлу, в который будет происходить запись сгенерированных данных
<json-server-address> - URL-адрес, на котором запущен тестовый json-server
<mongodb-connection-str> - Корректная строка для подключения к mongodb



## Структура проекта

### Директория `src`

Исходный код проекта: компоненты, модули и так далее. Структура директории `src` может быть произвольной.

### Файл `Readme.md`

Инструкции по работе с учебным репозиторием.

### Файл `Contributing.md`

Советы и инструкции по внесению изменений в учебный репозиторий.

### Остальное

Все остальные файлы в проекте являются служебными. Пожалуйста, не удаляйте и не изменяйте их самовольно. Только если того требует задание или наставник.
