<!-- @import "[TOC]" {cmd="toc" depthFrom=1 depthTo=6 orderedList=false} -->

<!-- code_chunk_output -->

- [Как работать над проектом](#как-работать-над-проектом)
  - [:golf: Окружение](#golf-окружение)
    - [:scroll: Сценарии](#scroll-сценарии)
      - [:arrow_forward: Скомпилировать проект](#arrow_forward-скомпилировать-проект)
      - [:no_entry_sign: Удалить скомпилированный проект](#no_entry_sign-удалить-скомпилированный-проект)
      - [:arrow_forward: Собрать проект](#arrow_forward-собрать-проект)
      - [:heavy_check_mark: Проверить линтером](#heavy_check_mark-проверить-линтером)
      - [:arrow_forward: Запустить ts-модуль без компиляции](#arrow_forward-запустить-ts-модуль-без-компиляции)
      - [:arrow_forward: Запустить проект](#arrow_forward-запустить-проект)
      - [:arrow_forward: Запустить проект в режиме разработки](#arrow_forward-запустить-проект-в-режиме-разработки)
      - [:arrow_forward: Запустить тестовый json-сервер](#arrow_forward-запустить-тестовый-json-сервер)
      - [:high_brightness: Конфигурация Docker для работы приложения](#high_brightness-конфигурация-docker-для-работы-приложения)
      - [:page_facing_up: Переменные окружения](#page_facing_up-переменные-окружения)
  - [:computer: Работа с CLI-приложени](#computer-работа-с-cli-приложени)
      - [:page_facing_up: Список доступных команд:](#page_facing_up-список-доступных-команд)
          - [:triangular_flag_on_post: Версия приложения:](#triangular_flag_on_post-версия-приложения)
          - [:triangular_flag_on_post: Генерация моковых данных (должен быть предварительно запущен моковый json-сервер):](#triangular_flag_on_post-генерация-моковых-данных-должен-быть-предварительно-запущен-моковый-json-серверзапустить-тестовый-json-сервер)
          - [:triangular_flag_on_post: Парсинг файла с моковыми данными, сгенерированными командой —generate с дальнейшим занемением их в БД:](#triangular_flag_on_post-парсинг-файла-с-моковыми-данными-сгенерированными-командой-generate-с-дальнейшим-занемением-их-в-бд)
  - [:bookmark_tabs: Структура проекта](#bookmark_tabs-структура-проекта)
    - [Директория `src`](#директория-src)
    - [Файл `Readme.md`](#файл-readmemd)
    - [Файл `Contributing.md`](#файл-contributingmd)
    - [Остальное](#остальное)

<!-- /code_chunk_output -->


# Как работать над проектом

## :golf: Окружение

Для удобства работы над проектом используются инструменты из **Node.js** и **npm**. Все необходимые настройки произведены. Убедитесь, что на рабочем компьютере установлен актуальный LTS релиз Node.js**. Актуальная версия **Node.js** указана в файле `package.json` в поле `node`. Затем, в терминале, перейдите в директорию с проектом и _единожды_ запустите команду:

```bash
npm install
```

Команда запустит процесс установки зависимостей проекта из **npm**.

### :scroll: Сценарии

В `package.json` предопределено несколько сценариев.

#### :arrow_forward: Скомпилировать проект

```bash
npm run compile
```

Создаст директорию `dist` и скомпилирует проект.

#### :no_entry_sign: Удалить скомпилированный проект

```bash
npm run clean
```

Удаляет директорию `dist`. Используется перед компиляцией.

#### :arrow_forward: Собрать проект

```bash
npm run build
```

Выполняет сборку проекта: удаляет ранее скомпилированный проект и компилирует заново.

#### :heavy_check_mark: Проверить линтером

```bash
npm run lint
```

Запуск проверки проекта статическим анализатором кода **ESLint**.

Линтер проверяет файлы только внутри директории `src`.

**Обратите внимание**, при запуске данной команды, ошибки выводятся в терминал.

#### :arrow_forward: Запустить ts-модуль без компиляции

```bash
npm run ts -- <Путь к модулю с ts-кодом>
```

Пакет `ts-node` позволяет выполнить TS-код в Node.js без предварительной компиляции. Используется только на этапе разработки.

#### :arrow_forward: Запустить проект

```bash
npm start
```

В процессе запуска проекта будет выполнен процесс «Сборки проекта» и запуска результирующего кода.

#### :arrow_forward: Запустить проект в режиме разработки

```bash
npm run start:dev
```

Отличия от обычного режима:
- NodeJs будет автоматически перезапускаться (средствами nodemon) каждый раз при изменении любых файлов в директории `src` с расширениями `.ts` / `.json`
- Перед выводом в консоль логи дополнительно обрабатывается пакетом `pino-pretty` для более читабельного вида

#### :arrow_forward: Запустить тестовый json-сервер

```bash
npm run json-server
```

В процессе запуска проекта будет создан тесовый `json-server`, который будет отдавать моковые данные при обращении по адресу `http://localhost:3000/api`  
- Офферы: `http://localhost:3000/api/offers/`  
- Пользователи: `http://localhost:3000/api/users`  

Данные для сервера находятся в директории `/src/mocks/`, файл `mock-server-data.json`


#### :high_brightness: Конфигурация Docker для работы приложения

```bash
docker compose --file ./docker-compose.dev.yml --env-file ./.env --project-name "six-cities" up -d
```

Данная команда сконфигурирует Docker-контейнер для приложения, а также развернет в нем образ `mongodb` и `mongo-express` для работы с базой данных.  
Конфигурационный файл `docker-compose.dev-yml` расположен в корне проекта.

#### :page_facing_up: Переменные окружения

`PORT=8000` - Порт, на котором запускается сервер приложения  
`HOST=localhost` - Хост, на котором запускается сервер приложения  
`PROTO=http` - Протокол подключения к хосту  
`DB_HOST=127.0.0.1` - Хост, на котором развернута база данных  
`DB_PORT=27017` - Порт, на котором развернута база данных  
`DB_NAME=six-cities_mongodb` - Название БД в MondoDB  
`DB_NAME_EXPRESS=six-cities_mongo_express` - Наименовение UI, используемого для доступа к БД через браузер  
`DB_USER=admin` - Логин пользователя к используемой базе данных (MongoDB)  
`DB_PASSWORD=test` - Пароль пользователя к используемой базе данных (MongoDB)  
`SALT=[ogj=-2049jt]` - Соль, используемая для формирования хэша паролей пользователей  
`UPLOAD_FILES_DIRECTORY=С:\some\path\six-cities.loc\upload` - Директория загрузки пользовательских файлов  
`STATIC_FILES_DIRECTORY=С:\some\path\six-cities.loc\upload` - Директория хранения статичных файлов, необходимых для работы приложения
`JWT_SECRET=ih-034thf0p9it43` - Секрет для формирования JWT-токенов  
`JWT_SECRET_REFRESH=dpojfg-045j9g0` - Секрет для обновления JWT-токенов  
`JWT_EXPIRED=2d` - Время жизни сформированных токенов  
`JWT_ALGORITHM=HS256` - Алгоритм, используемый для шифрования JWT-токенов  

Примеры переменных окружения также представлены в файле .env.example

## :computer: Работа с CLI-приложени

#### :page_facing_up: Список доступных команд:

```bash
npm run ts ./src/main.cli.ts -- --help
```

###### :triangular_flag_on_post: Версия приложения:

```bash
npm run ts ./src/main.cli.ts -- --version
```

###### :triangular_flag_on_post: Генерация моковых данных (должен быть предварительно запущен [моковый json-сервер](#запустить-тестовый-json-сервер)):

```bash
npm run ts ./src/main.cli.ts — —generate <mocks-count> <tsv-file-path> <json-server-address>
```

:heavy_check_mark: ***Пример:***

```bash
npm run ts ./src/main.cli.ts — —generate 10 ./src/mocks/mocks-data.tsv http://localhost:3000/api
```

###### :triangular_flag_on_post: Парсинг файла с моковыми данными, сгенерированными командой —generate с дальнейшим занемением их в БД:

```bash
npm run ts ./src/main.cli.ts — —import <tsv-file-path> <mongodb-connection-str>
```

:heavy_check_mark: ***Пример:***

```bash
npm run ts ./src/main.cli.ts — —import ./src/mocks/mocks-data.tsv mongodb://admin:test@127.0.0.1:27017/six-cities_mongodb?authSource=admin
```

:page_facing_up:  ***Параметры команд:***  
***(при указании параметров угловые скобки опускаются)***
- `<mocks-count>`(число) - Количество генерируемых комлектов данных  
- `<tsv-file-path>` - Путь к .tsv файлу, в который будет происходить запись сгенерированных данных  
- `<json-server-address>` - URL-адрес, на котором запущен тестовый json-server  
- `<mongodb-connection-str>` - Корректная строка для подключения к mongodb  



## :bookmark_tabs: Структура проекта

### Директория `src`

Исходный код проекта: компоненты, модули и так далее. Структура директории `src` может быть произвольной.

### Файл `Readme.md`

Инструкции по работе с учебным репозиторием.

### Файл `Contributing.md`

Советы и инструкции по внесению изменений в учебный репозиторий.

### Остальное

Все остальные файлы в проекте являются служебными. Пожалуйста, не удаляйте и не изменяйте их самовольно. Только если того требует задание или наставник.
